/*! moviq-build 2015-04-06 */
Hilary.scope("moviqContainer").register({name:"locale::en_US",factory:{errors:{interfaces:{requiresImplementation:"An implementation is required to create a new instance of an interface",requiresProperty:"The implementation is missing a required property: ",requiresArguments:"The implementation of this function requires the arguments: "},jqButtons:{fullscreenNotSupported:"Sorry, we don't recognize your browser, so we can't toggle fullscreen mode."}},messages:{browserNotSupported:"Sorry, a browser that supports HTML5 video playback is required to view this content."}}}),Hilary.scope("moviqContainer").register({name:"IButtons",dependencies:["locale"],factory:function(){"use strict";return function(a){var b=this,c=a||{};b.togglePlay=c.togglePlay,b.toggleFullscreen=c.toggleFullscreen,b.toggleCaptions=c.toggleCaptions,b.changeCaption=c.changeCaption,b.toggleMute=c.toggleMute,b.toggleQuality=c.toggleQuality,b.changeQuality=c.changeQuality,b.toggleSpeed=c.toggleSpeed,b.changeSpeed=c.changeSpeed}}}),Hilary.scope("moviqContainer").register({name:"ICaption",dependencies:["locale"],factory:function(a){"use strict";return function(b){var c=this;if(!b)throw new Error(a.errors.interfaces.requiresImplementation);if("string"!=typeof b.src)throw new Error(a.errors.interfaces.requiresProperty+"src");if("string"!=typeof b.srclang)throw new Error(a.errors.interfaces.requiresProperty+"srclang");if("string"!=typeof b.label)throw new Error(a.errors.interfaces.requiresProperty+"label");c.src=b.src,c.srclang=b.srclang,c.label=b.label}}}),Hilary.scope("moviqContainer").register({name:"IEventEmitter",dependencies:["locale"],factory:function(a){"use strict";return function(b){var c=this;if(!b)throw new Error(a.errors.interfaces.requiresImplementation);if("function"!=typeof b.emit)throw new Error(a.errors.interfaces.requiresProperty+"emit");if(2!==b.emit.length)throw new Error(a.errors.interfaces.requiresArguments+"type, data");c.emit=b.emit}}}),Hilary.scope("moviqContainer").register({name:"IEvents",dependencies:["locale"],factory:function(){"use strict";return function(a){var b=this,c=function(){};b.onLoadMetadata=a.onLoadMetadata||c,b.onTimeUpdate=a.onTimeUpdate||c,b.onCanPlay=a.onCanPlay||c,b.onCanPlayThrough=a.onCanPlayThrough||c,b.onVideoEnded=a.onVideoEnded||c,b.onSeeking=a.onSeeking||c,b.onSeekComplete=a.onSeekComplete||c,b.onWaiting=a.onWaiting||c,b.onError=a.onError||c,b.onPlay=a.onPlay||c,b.onPause=a.onPause||c,b.onShowCaptions=a.onShowCaptions||c,b.onHideCaptions=a.onHideCaptions||c,b.onToggleSpeed=a.onToggleSpeed||c,b.onChangeSpeed=a.onChangeSpeed||c,b.onToggleQuality=a.onToggleQuality||c,b.onChangeQuality=a.onChangeQuality||c,b.onSoundOn=a.onSoundOn||c,b.onSoundOff=a.onSoundOff||c,b.onFullscreenOn=a.onFullscreenOn||c,b.onFullscreenOff=a.onFullscreenOff||c}}}),Hilary.scope("moviqContainer").register({name:"IHtmlTemplateGenerator",dependencies:["locale"],factory:function(a){"use strict";return function(b){var c=this,d=b||{};if(!b)throw new Error(a.errors.interfaces.requiresImplementation);if("function"!=typeof d.makeControlsMarkup)throw new Error(a.errors.interfaces.requiresProperty+"makeControlsMarkup");if(2!==d.makeControlsMarkup.length)throw new Error(a.errors.interfaces.requiresArguments+"sources, captions");if("function"!=typeof d.makeSourceMarkup)throw new Error(a.errors.interfaces.requiresProperty+"makeSourceMarkup");if(1!==d.makeSourceMarkup.length)throw new Error(a.errors.interfaces.requiresArguments+"iSourceArray");if("function"!=typeof d.makeCaptionMarkup)throw new Error(a.errors.interfaces.requiresProperty+"makeCaptionMarkup");if(1!==d.makeCaptionMarkup.length)throw new Error(a.errors.interfaces.requiresArguments+"iCaptionArray");if("function"!=typeof d.makeHeaderMarkup)throw new Error(a.errors.interfaces.requiresProperty+"makeHeaderMarkup");if(1!==d.makeHeaderMarkup.length)throw new Error(a.errors.interfaces.requiresArguments+"header");if("function"!=typeof d.makeSnapshotMarkup)throw new Error(a.errors.interfaces.requiresProperty+"makeSnapshotMarkup");if("function"!=typeof d.makeVideoMarkup)throw new Error(a.errors.interfaces.requiresProperty+"makeVideoMarkup");if(1!==d.makeVideoMarkup.length)throw new Error(a.errors.interfaces.requiresArguments+"poster");c.makeControlsMarkup=d.makeControlsMarkup,c.makeSourceMarkup=d.makeSourceMarkup,c.makeCaptionMarkup=d.makeCaptionMarkup,c.makeHeaderMarkup=d.makeHeaderMarkup,c.makeSnapshotMarkup=d.makeSnapshotMarkup,c.makeVideoMarkup=d.makeVideoMarkup}}}),Hilary.scope("moviqContainer").register({name:"IManifest",dependencies:["locale"],factory:function(){"use strict";return function(a){var b=this,c=a||{};b.poster=c.poster,b.header=c.header,b.preload=c.preload,b.sources=c.sources instanceof Array?c.sources:[],b.captions=c.captions instanceof Array?c.captions:[]}}}),Hilary.scope("moviqContainer").register({name:"IMoviq",dependencies:["locale","IManifest"],factory:function(a,b){"use strict";return function(c){var d=this,e=c||{};if(!c)throw new Error(a.errors.interfaces.requiresImplementation);if("function"!=typeof e.ify)throw new Error(a.errors.interfaces.requiresProperty+"ify");if("function"!=typeof e.bindAll)throw new Error(a.errors.interfaces.requiresProperty+"bindAll");d.ify=e.ify,d.bindAll=e.bindAll,d.Manifest=b}}}),Hilary.scope("moviqContainer").register({name:"IProgressMeter",dependencies:["locale"],factory:function(a){"use strict";return function(b){var c=this,d=b||{};if(!b)throw new Error(a.errors.interfaces.requiresImplementation);if("function"!=typeof d.init)throw new Error(a.errors.interfaces.requiresProperty+"init");if(1!==b.init.length)throw new Error(a.errors.interfaces.requiresArguments+"iVideo");c.init=d.init}}}),Hilary.scope("moviqContainer").register({name:"ISnapshot",dependencies:["locale"],factory:function(a){"use strict";return function(b){var c=this,d=b||{};if(!b)throw new Error(a.errors.interfaces.requiresImplementation);if("function"!=typeof d.grab)throw new Error(a.errors.interfaces.requiresProperty+"grab");if(1!==d.grab.length)throw new Error(a.errors.interfaces.requiresArguments+"iVideo");c.grab=d.grab}}}),Hilary.scope("moviqContainer").register({name:"ISource",dependencies:["locale"],factory:function(a){"use strict";return function(b){var c=this;if(!b)throw new Error(a.errors.interfaces.requiresImplementation);if("string"!=typeof b.src)throw new Error(a.errors.interfaces.requiresProperty+"src");if("string"!=typeof b.type)throw new Error(a.errors.interfaces.requiresProperty+"type");if("string"!=typeof b.label)throw new Error(a.errors.interfaces.requiresProperty+"label");c.src=b.src,c.type=b.type,c.label=b.label}}}),Hilary.scope("moviqContainer").register({name:"ISourceParser",dependencies:["locale"],factory:function(a){"use strict";return function(b){var c=this,d=b||{};if(!b)throw new Error(a.errors.interfaces.requiresImplementation);if("function"!=typeof d.getSources)throw new Error(a.errors.interfaces.requiresProperty+"getSources");if(1!==d.getSources.length)throw new Error(a.errors.interfaces.requiresArguments+"iVideo");if("function"!=typeof d.getCaptions)throw new Error(a.errors.interfaces.requiresProperty+"getCaptions");if(1!==d.getCaptions.length)throw new Error(a.errors.interfaces.requiresArguments+"iVideo");if("function"!=typeof d.convertSources)throw new Error(a.errors.interfaces.requiresProperty+"convertSources");if(1!==d.convertSources.length)throw new Error(a.errors.interfaces.requiresArguments+"sourceArray");if("function"!=typeof d.convertCaptions)throw new Error(a.errors.interfaces.requiresProperty+"convertCaptions");if(1!==d.convertCaptions.length)throw new Error(a.errors.interfaces.requiresArguments+"captionArray");c.getSources=d.getSources,c.getCaptions=d.getCaptions,c.convertSources=d.convertSources,c.convertCaptions=d.convertCaptions}}}),Hilary.scope("moviqContainer").register({name:"ISourceManifestParser",dependencies:["locale"],factory:function(a){"use strict";return function(b){var c=this,d=b||{};if(!b)throw new Error(a.errors.interfaces.requiresImplementation);if("function"!=typeof d.getSourcesByManifest)throw new Error(a.errors.interfaces.requiresProperty+"getSourcesByManifest");if(1!==d.getSourcesByManifest.length)throw new Error(a.errors.interfaces.requiresArguments+"iVideo");c.getSourcesByManifest=d.getSourcesByManifest}}}),Hilary.scope("moviqContainer").register({name:"ITimeFormatter",dependencies:["locale"],factory:function(a){"use strict";return function(b){var c=this,d=b||{};if(!b)throw new Error(a.errors.interfaces.requiresImplementation);if("function"!=typeof d.formatTime)throw new Error(a.errors.interfaces.requiresProperty+"formatTime");if(2!==d.formatTime.length)throw new Error(a.errors.interfaces.requiresArguments+"ITimeFormatter.formatTime(seconds, useLeadingZero)");c.formatTime=d.formatTime}}}),Hilary.scope("moviqContainer").register({name:"IVideo",dependencies:["locale"],factory:function(){"use strict";return function(a){var b=this,c=a||{};b.events=c.events,b.sources=c.sources,b.captions=c.captions,b.buttons=c.buttons,b.progressMeter=c.progressMeter,b.manifestUrl=c.manifestUrl,b.watchReport=c.watchReport,b.duration=c.duration,b.dom={handle:c.dom.handle,video:c.dom.video,controls:c.dom.controls,header:c.dom.header}}}}),Hilary.scope("moviqContainer").register({name:"IVideoInitializer",dependencies:["locale"],factory:function(a){"use strict";return function(b){var c=this,d=b||{};if(!b)throw new Error(a.errors.interfaces.requiresImplementation);if("function"!=typeof d.bindVideos)throw new Error(a.errors.interfaces.requiresProperty+"bindVideos");if(2!==d.bindVideos.length)throw new Error(a.errors.interfaces.requiresArguments+"querySelector, manifest");c.bindVideos=d.bindVideos}}}),Hilary.scope("moviqContainer").register({name:"consoleEventEmitter",dependencies:["locale","IEventEmitter"],factory:function(a,b){"use strict";return function(a){return new b({emit:function(b,c){console.log("moviq-event",[b,c]);var d,e=c;delete e.event,d={type:b,data:e,position:a.dom.video.currentTime,eventTime:(new Date).toISOString()},a.watchReport.events.push(d),a.watchReport.updateCoverageReport()}})}}}),Hilary.scope("moviqContainer").register({name:"defaultEventHandlers",dependencies:["locale"],factory:function(){"use strict";return function(a){var b={};return b.onError=function(b){throw a.emit("moviq-error",{message:b}),new Error(b)},b.onPlay=function(b){a.emit("moviq-play",{event:b})},b.onPause=function(b){a.emit("moviq-pause",{event:b})},b.onShowCaptions=function(b,c){a.emit("moviq-show-captions",{language:b,event:c})},b.onHideCaptions=function(b,c){a.emit("moviq-hide-captions",{language:b,event:c})},b.onToggleSpeed=function(b){a.emit("moviq-toggle-speed",{event:b})},b.onChangeSpeed=function(b,c){a.emit("moviq-change-speed",{speed:c,event:b})},b.onToggleQuality=function(b){a.emit("moviq-toggle-quality",{event:b})},b.onChangeQuality=function(b,c){a.emit("moviq-change-quality",{quality:b,event:c})},b.onSoundOn=function(b){a.emit("moviq-sound-on",{event:b})},b.onSoundOff=function(b){a.emit("moviq-sound-off",{event:b})},b.onFullscreenOn=function(b){a.emit("moviq-fullscreen-on",{event:b})},b.onFullscreenOff=function(b){a.emit("moviq-fullscreen-off",{event:b})},b}}}),Hilary.scope("moviqContainer").register({name:"defaultHtmlTemplates",dependencies:["locale"],factory:function(a){"use strict";var b,c,d,e,f,g,h,i,j,k;return b='<div class="moviq-controls"><div class="moviq-controls-enclosure-more moviq-controls-quality"></div><div class="moviq-controls-enclosure-more moviq-controls-speed"><output class=" moviq-btn-text moviq-current-speed">1x</output><input class="moviq-speed-chooser" type="range" min=".25" max="3" step=".25" value="1" aria-label="Choose a playback speed" /></div><div class="moviq-controls-enclosure-more moviq-controls-cc"></div><div class="moviq-controls-enclosure"><div class="moviq-controls-left"><button class="moviq-btn moviq-btn-play" aria-label="Play or pause the video"><span class="fa fa-play"></span></button></div><div class="moviq-progress"><span class="moviq-progress-display"></span><span class="moviq-progress-picker"></span><div class="moviq-progress-bar" aria-label="This bar shows the current position of the video, as well as the amount buffered. You can click anywhere in this bar to seek to a new position."><span class="moviq-progress-buffer"></span><span class="moviq-progress-time"></span></div></div><div class="moviq-controls-right"><button class="moviq-btn moviq-btn-cc" aria-label="Toggle closed captions. This will open a menu, if more than one text track is available."><i class="fa fa-cc"></i></button><button class="moviq-btn moviq-btn-speed moviq-btn-submenu" aria-label="Toggle the controls for choosing a playback speed"><i class="fa fa-clock-o"></i></button><button class="moviq-btn moviq-btn-quality moviq-btn-submenu moviq-btn-text" aria-label="Toggle the video quality options"><em>HD</em></button><button class="moviq-btn moviq-btn-mute" aria-label="Mute or unmute sound"><span class="fa fa-volume-off"></span></button><button class="moviq-btn moviq-btn-fullscreen" aria-label="Toggle fullscreen"><span class="fa fa-arrows-alt"></span></button></div></div></div>',c='<button class="moviq-btn moviq-btn-choose-quality moviq-btn-text" aria-label="Set the video quality to: {0}" data-quality="{0}"><em>{0}</em></button>',d='<button class="moviq-btn moviq-btn-choose-cc moviq-btn-text" aria-label="Set the closed captions to: {lang}" data-lang="{lang}" data-id="{id}"><em>{lang}</em></button>',e='<source type="{type}" data-label="{label}" src="{src}" />',f='<track label="{label}" kind="captions" srclang="{srclang}" src="{src}" data-id="{id}">',g='<div class="moviq-header">{header}</div>',h='<canvas class="moviq-snapshot moviq-hidden"></canvas>',i='<div class="moviq-poster" style="background-image: url({poster});"></div>',j='<video><p class="video-not-supported">'+a.messages.browserNotSupported+"</p></video>",k='<video poster="{poster}"><p class="video-not-supported">'+a.messages.browserNotSupported+"</p></video>",{controls:b,qualityButton:c,ccButton:d,sourceElement:e,trackElement:f,header:g,canvas:h,poster:i,video:j,videoWithPoster:k}}}),Hilary.scope("moviqContainer").register({name:"simpleEventEmitter",dependencies:["locale","IEventEmitter"],factory:function(a,b){"use strict";return new b({emit:function(a,b){console.log("moviq-event",[a,b])}})}}),Hilary.scope("moviqContainer").register({name:"snapshot",dependencies:["locale","ISnapshot"],factory:function(a,b){"use strict";var c,d;return c=function(a){var b,c,e=a.dom.canvas;e&&e.getContext&&(b=e.getContext("2d"),c=d(a),b.fillRect(0,0,c.canvasWidth,c.canvasHeight),b.drawImage(a.dom.video,0,0,c.canvasWidth,c.canvasHeight))},d=function(a){var b,c=a.dom.video,d=a.dom.canvas,e={};return b=c.videoWidth/c.videoHeight,e.width=c.videoWidth,e.height=parseInt(e.width/b,10),e.canvasWidth=Math.max(1,Math.floor(a.dom.video.clientWidth)),e.canvasHeight=Math.max(1,Math.floor(a.dom.video.clientHeight)),e.canvasVideoHeight=parseInt(e.canvasWidth/b,10),e.dy=e.canvasVideoHeight-e.canvasHeight,d.width=e.canvasWidth,d.height=e.canvasHeight,e},new b({grab:c})}}),Hilary.scope("moviqContainer").register({name:"timeFormatter",dependencies:["locale","ITimeFormatter"],factory:function(a,b){"use strict";var c=function(a,b){var c,d;return c=b&&Math.floor(a/60)<10?"0"+Math.floor(a/60):Math.floor(a/60),d=Math.floor(a-60*c)<10?"0"+Math.floor(a-60*c):Math.floor(a-60*c),c+":"+d};return new b({formatTime:c})}}),Hilary.scope("moviqContainer").register({name:"IJqVideo",dependencies:["locale","IVideo"],factory:function(a,b){"use strict";return function(a){var c=new b(a),d=a||{};return c.$dom={$handle:d.$dom.$handle,$video:d.$dom.$video,$controls:d.$dom.$controls,$header:d.$dom.$header},c}}}),Hilary.scope("moviqContainer").register({name:"jqButtons",dependencies:["locale","jqQuerySelectors","IButtons","snapshot","jQuery"],factory:function(a,b,c,d,e){"use strict";var f,g,h,i;return i=function(){var a,b,c,d=!1;return b=function(){e(document).mousemove(function(){d||(d=!1,clearTimeout(a),e("html").css({cursor:"default"}),a=setTimeout(c,1e3))})},c=function(){e("html").css({cursor:"none"}),d=!0,setTimeout(function(){d=!1},500)},{bind:b}},g=function(a,b,c){var d=c.controls.getHandle(c.controls.play),f=c.controls.getHandle(c.controls.cc),g=c.controls.getHandle(c.controls.cc_choice),h=c.controls.getHandle(c.controls.speed),i=c.controls.getHandle(c.controls.quality),j=c.controls.getHandle(c.controls.quality_choice),k=c.controls.getHandle(c.controls.mute),l=c.controls.getHandle(c.controls.fullscreen),m=c.controls.getHandle(c.controls.speed_chooser),n=c.controls.getHandle(c.controls.speed_current);a.$dom.$handle.on("mouseenter",function(b){a.$dom.$controls.stop().fadeTo(500,.9),a.$dom.$header.stop().fadeTo(500,.9),e(b.target).parent().hasClass("fullscreen")&&e("html").css({cursor:"default"})}).on("mouseleave",function(b){a.$dom.$controls.stop().fadeOut(),a.$dom.$header.stop().fadeOut(),e(b.target).parent().hasClass("fullscreen")&&e("html").css({cursor:"none"})}),d.on("click",function(c){var d=b.togglePlay();1===d?a.events.onPlay(c):0===d&&a.events.onPause(c)}),f.on("click",function(c){var d=b.toggleCaptions();1===d?a.events.onShowCaptions(c):0===d&&a.events.onHideCaptions(c)}),g.on("click",function(c){var d=e(c.currentTarget),f=b.changeCaption(d);1===f.toggle?a.events.onShowCaptions(f.lang,c):0===f.toggle&&a.events.onHideCaptions(f.lang,c)}),h.on("click",function(c){b.toggleSpeed();a.events.onToggleSpeed(c)}),m.on("change mousemove",function(c){var d=b.changeSpeed(m.val());n.text(m.val()+"x"),d.changed&&a.events.onChangeSpeed(c,d.newSpeed)}),i.on("click",function(c){b.toggleQuality();a.events.onToggleQuality(c)}),j.on("click",function(c){var d=e(c.currentTarget),f=d.attr("data-quality"),g=b.changeQuality(f);a.events.onChangeQuality(g)}),k.on("click",function(c){var d=b.toggleMute();1===d?a.events.onSoundOn(c):0===d&&a.events.onSoundOff(c)}),l.on("click",function(c){var d=b.toggleFullscreen();1===d?a.events.onFullscreenOn(c):0===d&&a.events.onFullscreenOff(c)})},h=function(b,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s=b.$dom.$video,t=b.dom.video;return f=function(){var a=e.controls.getIconHandle(e.controls.play);return t.paused||t.ended?(a.removeClass("fa-play").addClass("fa-pause"),t.play(),1):(a.removeClass("fa-pause").addClass("fa-play"),t.pause(),0)},j=function(){var a=b.$dom.$handle;return a.hasClass("fullscreen")?(l(b),0):(k(b),1)},k=function(){var c=b.dom.handle,d=b.$dom.$handle,f=e.controls.getIconHandle(e.controls.fullscreen);c.requestFullscreen?c.requestFullscreen():c.msRequestFullscreen?c.msRequestFullscreen():c.mozRequestFullScreen?c.mozRequestFullScreen():c.webkitRequestFullscreen?c.webkitRequestFullscreen():b.events.onError(a.errors.jqButtons.fullscreenNotSupported),d.addClass("fullscreen"),f.removeClass("fa-arrows-alt").addClass("fa-compress")},l=function(){var a=(b.dom.handle,b.$dom.$handle),c=e.controls.getIconHandle(e.controls.fullscreen);a.removeClass("fullscreen"),c.removeClass("fa-compress").addClass("fa-arrows-alt"),document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},g=function(){var a=e.controls.getHandle(e.controls.cc),c=t.textTracks[0],d=t.textTracks.length<1,f=t.textTracks.length>1;return d?void 0:f?p(a,"with-cc"):h(a,b.captions[0].srclang,c)},h=function(a,b,c){if(a.hasClass("selected")){if(a.removeClass("selected"),c)return c.mode="hidden",{state:0,lang:b}}else if(a.addClass("selected"),c)return c.mode="showing",{state:1,lang:b}},i=function(a){var b=a.attr("data-lang"),c=parseInt(a.attr("data-id"),10),d=t.textTracks[c];return h(a,b,d)},m=function(){var a=e.controls.getIconHandle(e.controls.mute);return t.muted=!t.muted,a.hasClass("fa-volume-off")?(a.removeClass("fa-volume-off").addClass("fa-volume-up"),0):(a.removeClass("fa-volume-up").addClass("fa-volume-off"),1)},n=function(){var a=e.controls.getHandle(e.controls.speed);p(a,"with-speed")},o=function(a){if("number"==typeof a){var b=a.toFixed(2),c=t.playbackRate.toFixed(2);return b!==c?(t.playbackRate=a,{newSpeed:b,changed:!0}):{newSpeed:b,changed:!1}}if("string"!=typeof a)return{newSpeed:t.playbackRate.toFixed(2),changed:!1};try{return o(parseFloat(a))}catch(d){return t.playbackRate}},q=function(){var a=e.controls.getHandle(e.controls.quality),c=b.sources.length<2;c||p(a,"with-quality")},r=function(a){var c,g,h,i,j="moviq-hidden";for(d.grab(b),b.$dom.$handle.children(e.canvas).removeClass(j),h=0;h<b.sources.length;h+=1)if(b.sources[h].label===a){c=b.sources[h];break}return i=c.label.length>2?c.label.substr(0,2):c.label,e.controls.getHandle(e.controls.quality+" em").text(i),g=t.currentTime,t.paused||f(),t.src=c.src,t.load(),s.one("loadedmetadata",function(){t.currentTime=g,f(),s.one("playing",function(){b.$dom.$handle.children(e.canvas).addClass(j)})}),c},p=function(a,c){if(a.hasClass("selected"))a.removeClass("selected"),b.$dom.$controls.removeClass(c);else{var d;for(e.controls.getHandle(e.controls.subMenuButton+".selected").removeClass("selected"),d=0;d<e.controls.subMenus.length;d+=1)b.$dom.$controls.removeClass(e.controls.subMenus[d]);a.addClass("selected"),b.$dom.$controls.addClass(c)}},new c({togglePlay:f,toggleCaptions:g,changeCaption:i,toggleFullscreen:j,toggleMute:m,toggleSpeed:n,changeSpeed:o,toggleQuality:q,changeQuality:r})},f=function(a){var c=b(a),d=h(a,c);return g(a,d,c),a.captions.length>1&&c.controls.getHandle(c.controls.cc).addClass(c.controls.subMenuButtonClassName),d},{init:f}}}),Hilary.scope("moviqContainer").register({name:"jqEventEmitter",dependencies:["locale","IEventEmitter","jQuery"],factory:function(a,b,c){"use strict";return function(a){return new b({emit:function(b,d){c(document).trigger(b,[d]).trigger("moviq-event",[b,d]);var e,f=d;delete f.event,e={type:b,data:f,position:a.dom.video.currentTime,eventTime:(new Date).toISOString()},a.watchReport.events.push(e),a.watchReport.updateCoverageReport()}})}}}),Hilary.scope("moviqContainer").register({name:"jqHtmlTemplateGenerator",dependencies:["locale","defaultHtmlTemplates","IHtmlTemplateGenerator","jqQuerySelectors","jQuery"],factory:function(a,b,c,d,e){"use strict";var f,g,h,i,j,k;return f=function(a,c){var f,g,h,i,j=d();for(f=e(b.controls),g=f.find(j.controls.quality_menu),h=f.find(j.controls.cc_menu),i=0;i<a.length;i+=1)g.append(b.qualityButton.replace(/\{0\}/g,a[i].label));if(c)for(i=0;i<c.length;i+=1)h.append(b.ccButton.replace(/\{lang\}/g,c[i].label).replace(/\{id\}/g,i.toString()));return f[0]},g=function(a){var c,d="";for(c=0;c<a.length;c+=1)d+=b.sourceElement.replace(/\{type\}/,a[c].type).replace(/\{label\}/,a[c].label).replace(/\{src\}/,a[c].src);return d},h=function(a){var c,d="";for(c=0;c<a.length;c+=1)d+=b.trackElement.replace(/\{label\}/,a[c].label).replace(/\{srclang\}/,a[c].srclang).replace(/\{src\}/,a[c].src).replace(/\{id\}/,c.toString());return d},j=function(){return b.canvas},i=function(a){return b.header.replace(/\{header\}/,a)},k=function(a){return a?b.videoWithPoster.replace(/\{poster\}/,a):b.video},new c({makeControlsMarkup:f,makeSourceMarkup:g,makeCaptionMarkup:h,makeHeaderMarkup:i,makeSnapshotMarkup:j,makeVideoMarkup:k})}}),Hilary.scope("moviqContainer").register({name:"jqProgressMeter",dependencies:["locale","jqQuerySelectors","timeFormatter","IProgressMeter"],factory:function(a,b,c,d){"use strict";var e=function(a){var d,e,f,g,h,i,j,k,l,m=b(a),n=!1;return d=a.$dom.$video,e=a.dom.video,f=m.controls.getHandle(m.controls.progress_bar),g=m.controls.getHandle(m.controls.progress_time),h=m.controls.getHandle(m.controls.progress_buffer),i=m.controls.getHandle(m.controls.progress_timeDisplay),k={getPositionPercent:function(){return 100*(e.currentTime/e.duration)},getBufferedPercent:function(){return e.buffered.length>0?100*(e.buffered.end(0)/e.duration):0},getAmountConsumed:function(){throw new Error("NOT IMPLEMENTED")}},l={setPosition:function(a){var b=l.getCoordinates(a).percent;e.pause(),l.updateDisplay(b),e.currentTime=e.duration*b/100,e.play()},getCoordinates:function(a){var b=a-f.offset().left,c=100*b/f.width();return c>100?c=100:0>c&&(c=0),{position:b,percent:c}},getPosition:function(a){var b=l.getCoordinates(a),d=e.duration*(b.percent/100);return{time:c.formatTime(d),left:b.position}},updateDisplay:function(a){var b=a||k.getPositionPercent(),d=k.getBufferedPercent(),f=c.formatTime(e.currentTime);e.duration>0&&(f+=" / "+c.formatTime(e.duration)),g.css("width",b+"%"),h.css("width",d+"%"),n||i.text(f)}},j=function(){var a=m.controls.getHandle(m.controls.progress_timeDisplay),b=m.controls.getHandle(m.controls.progress_timePicker);d.on("timeupdate",function(){l.updateDisplay()}),f.on("mousedown",function(a){l.setPosition(a.pageX)}).on("mouseleave",function(){b.text(""),n=!1}).on("mousemove",function(c){var d=l.getPosition(c.pageX);n=!0,a.text(""),b.text(d.time.replace(/NaN/gi,"00")),b.css("left",d.left)})},j(),l.updateDisplay(),l};return new d({init:e})}}),Hilary.scope("moviqContainer").register({name:"jqQuerySelectors",dependencies:[],factory:function(a){"use strict";return{header:".moviq-header",canvas:".moviq-snapshot",hidden:".moviq-hidden",controls:{control_container:".moviq-controls",more_controls_container:".moviq-controls-enclosure-more",play:".moviq-btn-play",mute:".moviq-btn-mute",fullscreen:".moviq-btn-fullscreen",cc:".moviq-btn-cc",cc_choice:".moviq-btn-choose-cc",cc_menu:".moviq-controls-cc",speed:".moviq-btn-speed",speed_chooser:".moviq-speed-chooser",speed_current:".moviq-current-speed",choose_speed:".moviq-btn-choose-speed",quality_menu:".moviq-controls-quality",quality:".moviq-btn-quality",quality_choice:".moviq-btn-choose-quality",progress:".moviq-progress",progress_bar:".moviq-progress-bar",progress_buffer:".moviq-progress-buffer",progress_time:".moviq-progress-time",progress_timeDisplay:".moviq-progress-display",progress_timePicker:".moviq-progress-picker",buttons_right:".moviq-buttons-right",controls_left:".moviq-controls-left",controls_right:".moviq-controls-right",subMenus:["with-speed","with-quality","with-cc"],subMenuButtonClassName:"moviq-btn-submenu",subMenuButton:".moviq-btn-submenu",getHandle:function(b){return a.$dom.$controls.find(b)},getIconHandle:function(b){return a.$dom.$controls.find(b+" span")}}}}}),Hilary.scope("moviqContainer").register({name:"jqSourceParser",dependencies:["locale","ISource","ICaption","ISourceParser","jQuery"],factory:function(a,b,c,d,e){"use strict";var f,g,h,i,j,k;return g=function(a){var b,c,d=[],g=f(a.$dom.$video),h=a.$dom.$video.children("source");for(g&&d.push(g),c=0;c<h.length;c+=1)b=f(e(h[c]),c),b&&d.push(b);return d},f=function(a,c){var d=a.attr("src"),e=a.attr("type"),f=a.attr("data-label");return d&&e?new b({src:d,type:e,label:f||"Q"+((c||0)+1).toString()}):null},i=function(a){var b,c,d=[],f=a.$dom.$video.children("track");for(c=0;c<f.length;c+=1)b=h(e(f[c]),c),b&&d.push(b);return d},h=function(a){var b=a.attr("src"),d=a.attr("srclang"),e=a.attr("label"),f=a.attr("kind");return b&&d&&"captions"===f?new c({src:b,srclang:d,label:e||"unknown"}):null},j=function(a){var c,d=[];for(c=0;c<a.length;c+=1)d.push(new b(a[c]));return d},k=function(a){var b,d=[];for(b=0;b<a.length;b+=1)d.push(new c(a[b]));return d},new d({getSources:g,getCaptions:i,convertSources:j,convertCaptions:k})}}),Hilary.scope("moviqContainer").register({name:"jqVideo",dependencies:["locale","IJqVideo","IManifest","jqQuerySelectors","defaultEventHandlers","jqEventEmitter","jqButtons","jqProgressMeter","sourceParser","sourceManifestParser","htmlTemplateGenerator","timeFormatter","WatchReport","jQuery"],factory:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";var o,p,q,r,s,t,u;return p=function(a,b,d){var e,f=n("<div>"),g=new c(b);f.append(k.makeSnapshotMarkup()),g.header&&f.append(k.makeHeaderMarkup(g.header)),a.$dom.$video.length<1&&(e=k.makeVideoMarkup(g.poster),e=n(e).attr("preload","none")[0],f.append(e)),a.sources=i.convertSources(g.sources),a.captions=i.convertCaptions(g.captions),a.sources.length>0&&(f.children("video")[0].src=a.sources[0].src),a.captions.length>0&&f.children("video").append(k.makeCaptionMarkup(a.captions)),a.$dom.$handle.html(f.html()),a.$dom.$header=a.$dom.$handle.children(d.header).first(),a.dom.header=a.$dom.$header[0],a.$dom.$video=a.$dom.$handle.children("video").first(),a.dom.video=a.$dom.$video[0],a.$dom.$canvas=a.$dom.$handle.children(d.canvas).first(),a.dom.canvas=a.$dom.$canvas[0],g.preload&&a.$dom.$video.attr("preload",g.preload)},q=function(a){a.manifestUrl=a.dom.video.dataset.manifest,a.sources=j.getSourcesByManifest(a.dom.video.dataset.manifest),a.captions=void 0},r=function(a){a.sources=i.getSources(a),a.captions=i.getCaptions(a)},s=function(b){b.$dom.$video.children(".video-not-supported").length<1&&b.$dom.$video.append('<p class="video-not-supported">'+a.messages.browserNotSupported+"</p>")},t=function(a){if(a.dom.video.textTracks.length>0){var b=a.dom.video.textTracks[0];b.mode="hidden"}},u=function(a,b){var c=a.$dom.$handle.find(b.controls.control_container);c.length<1&&a.$dom.$handle.append(k.makeControlsMarkup(a.sources,a.captions)),a.$dom.$controls=a.$dom.$handle.children(b.controls.control_container).first(),a.dom.controls=a.$dom.$controls[0],a.captions.length<1&&a.$dom.$controls.find(b.controls.cc).attr("disabled","disabled").addClass("disabled"),a.sources.length<2&&a.$dom.$controls.find(b.controls.quality).attr("disabled","disabled").addClass("disabled")},o=function(a,c){var i,j=d(a);return i=new b({events:void 0,sources:void 0,captions:void 0,buttons:void 0,progress:void 0,manifestUrl:void 0,watchReport:void 0,$dom:{$handle:a,$video:a.children("video").first(),$controls:void 0,$header:a.children(j.header).first(),$canvas:void 0},dom:{handle:a[0],video:a.children("video").first()[0],controls:void 0,header:a.children(j.header).first()[0],canvas:void 0}}),i.events=e(f(i)),i.watchReport=new m(i),c?p(i,c,j):i.dom.video.dataset.manifest?q(i):r(i),s(i),t(i),u(i,j),i.buttons=g.init(i),i.progressMeter=h.init(i),a.addClass("moviqified"),i.$dom.$video.one("loadedmetadata",function(){i.duration=l.formatTime(i.dom.video.duration,!1)}),i}}}),Hilary.scope("moviqContainer").register({name:"jqVideoInitializer",dependencies:["locale","Video","IVideoInitializer","jQuery"],factory:function(a,b,c,d){"use strict";return new c({bindVideos:function(a,c){var e,f,g=[],h=".moviqified";for(a?"string"==typeof a?e=d(a).not(h):a instanceof d&&(e=a.not(h)):e=d(".moviq-video").not(h),0===e.length&&console.log("moviq info","no videos were found to process"),f=0;f<e.length;f+=1)g.push(new b(d(e[f]),c));return g}})}}),Hilary.scope("moviqContainer").register({name:"CoverageReport",dependencies:["locale"],factory:function(){"use strict";return function(a){var b=this,c=a||{};b.timeRanges=c.timeRanges,b.duration=c.duration,b.durationConsumed=c.durationConsumed,b.coverageAsPercent=c.coverageAsPercent,b.roundedCoverageAsPercent=Math.round(c.coverageAsPercent)}}}),Hilary.scope("moviqContainer").register({name:"WatchReport",dependencies:["locale","CoverageReport"],factory:function(a,b){"use strict";return function(a){var c=this;c.events=[],c.coverageReport=void 0,c.updateCoverageReport=function(){var d,e,f=a.dom.video,g=[],h=0,i=0,j=f.played||{},k=f.duration;for(d=0;d<j.length;d+=1)e={start:j.start(d),end:j.end(d)},g.push(e),h+=e.end-e.start;return i=100*h/k,c.coverageReport=new b({timeRanges:g,duration:k,durationConsumed:h,coverageAsPercent:i}),c.coverageReport}}}}),function(a,b){"use strict";var c;c=function(a){var b,c,d,e,f,g;a.register({name:"locale",factory:function(){return b||(b=a.resolve("locale::en_US")),b}}),a.register({name:"sourceParser",factory:function(){return c||(c=a.resolve("jqSourceParser")),c}}),a.register({name:"sourceManifestParser",factory:function(){return d||(d="NOT IMPLEMENTED"),d}}),a.register({name:"htmlTemplateGenerator",factory:function(){return e||(e=a.resolve("jqHtmlTemplateGenerator")),e}}),a.register({name:"Video",factory:function(){return f||(f=a.resolve("jqVideo")),f}}),a.register({name:"videoInitializer",factory:function(){return g||(g=a.resolve("jqVideoInitializer")),g
}})},a.Moviq=function(a){var d,e,f,g=a||{};return c(b),d=b.resolve("IMoviq"),e=b.resolve("videoInitializer"),f=new d({ify:e.bindVideos,bindAll:e.bindVideos}),g.bindNow&&f.bindAll(),f}}(window,Hilary.scope("moviqContainer"));